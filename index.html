<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Empire Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { background: #020617; color: #f1f5f9; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        #chat { flex-grow: 1; overflow-y: auto; padding: 1.5rem; background: radial-gradient(circle at center, #0f172a 0%, #020617 100%); }
        .rank-Ï¥àÏõîÏûê { color: #22d3ee; text-shadow: 0 0 15px #0891b2; font-weight: 900; }
        .link { color: #22d3ee; text-decoration: underline; font-weight: bold; }
        .reward-badge { background: #065f46; color: #34d399; font-size: 0.7rem; padding: 2px 8px; border-radius: 20px; margin-left: 8px; font-weight: bold; }
        #chat::-webkit-scrollbar { width: 5px; }
        #chat::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
    </style>
</head>
<body>
    <header class="p-4 bg-slate-900 border-b border-cyan-500/30 flex justify-between items-center shadow-xl">
        <h1 class="text-cyan-400 font-black italic">ULTIMATE MASTER EMPIRE</h1>
        <div id="status" class="text-[10px] text-slate-500 font-mono">ENCRYPTED CONNECTION</div>
    </header>

    <div id="chat"></div>

    <div class="p-4 bg-slate-900 border-t border-slate-800">
        <div id="f-info" class="text-[10px] text-cyan-400 mb-2 hidden animate-pulse"></div>
        <textarea id="msg" class="w-full bg-black/50 text-white p-4 rounded-2xl border border-slate-700 focus:border-cyan-500 outline-none mb-3" rows="2" placeholder="Î©îÏÑ∏ÏßÄ, ÎßÅÌÅ¨, Î™ÖÎ†πÏñ¥ ÏûÖÎ†•..."></textarea>
        <div class="flex gap-2">
            <label class="bg-slate-800 p-4 rounded-2xl text-xs cursor-pointer flex items-center">üìÅ ÌååÏùºÍ≥µÏú†<input type="file" id="f-in" class="hidden" onchange="showFile()"></label>
            <button onclick="send()" class="flex-grow bg-cyan-600 hover:bg-cyan-500 text-white rounded-2xl font-black transition-all active:scale-95">Ï†úÍµ≠ Ï†ÑÏÜ°</button>
        </div>
    </div>

    <script>
        const socket = io();
        let nick = prompt("ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî") || "User" + Math.floor(Math.random()*999);
        socket.on('connect', () => socket.emit('join', { nickname: nick }));

        function linkify(text) {
            return text.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" class="link">$1</a>');
        }

        socket.on('message', (d) => {
            const win = document.getElementById('chat');
            const div = document.createElement('div');
            div.className = "mb-6 animate-in fade-in slide-in-from-bottom-2 duration-300";
            
            if (d.type === 'noejul') {
                div.innerHTML = `<div class="p-3 bg-fuchsia-950/20 border border-fuchsia-500/30 text-fuchsia-300 rounded-lg text-xs italic">${d.msg}</div>`;
            } else if (d.type === 'system' || d.type === 'bot') {
                div.innerHTML = `<div class="bg-slate-800/50 border border-slate-700 text-cyan-300 text-xs p-4 rounded-2xl whitespace-pre-wrap">${linkify(d.msg)}</div>`;
            } else {
                const isMe = d.nickname === nick;
                div.innerHTML = `
                    <div class="flex flex-col ${isMe ? 'items-end' : ''}">
                        <div class="flex items-center mb-1">
                            <span class="text-[10px] text-slate-500 font-bold">${d.nickname}</span>
                            <span class="reward-badge">${d.reward}</span>
                        </div>
                        <div class="bg-slate-800/80 p-4 rounded-2xl max-w-[90%] whitespace-pre-wrap border border-slate-700 ${d.rank === 'Ï¥àÏõîÏûê' ? 'border-cyan-400' : ''}">
                            <span class="rank-${d.rank} text-sm">${linkify(d.msg)}</span>
                        </div>
                    </div>`;
            }
            win.appendChild(div);
            win.scrollTop = win.scrollHeight;
        });

        function showFile() {
            const f = document.getElementById('f-in').files[0];
            if(f) { document.getElementById('f-info').innerText = `‚úÖ ÌååÏùº Í∞êÏßÄ: ${f.name}`; document.getElementById('f-info').classList.remove('hidden'); }
        }

        async function send() {
            const i = document.getElementById('msg'); const fi = document.getElementById('f-in');
            if (fi.files[0]) {
                const fd = new FormData(); fd.append('file', fi.files[0]); fd.append('nickname', nick);
                await fetch('/upload', { method: 'POST', body: fd });
                fi.value = ''; document.getElementById('f-info').classList.add('hidden');
            }
            if (i.value.trim()) { socket.emit('send_msg', { nickname: nick, msg: i.value }); i.value = ''; }
        }
    </script>
</body>
</html>
