<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Gemini ë©€í‹°ë²„ìŠ¤ (Joyce í™©ì œ ì—ë””ì…˜)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { background: #0f172a; color: #f1f5f9; font-family: 'Pretendard', sans-serif; }
        #chat-window { height: 75vh; overflow-y: auto; border: 1px solid #1e293b; border-radius: 12px; }
        
        .msg-item { white-space: pre-wrap !important; word-break: break-all; padding: 12px; border-bottom: 1px solid #1e293b; transition: 0.3s; }

        /* ğŸ‘‘ í™©ì œ íš¨ê³¼ (500ë§Œ ì› ì´ìƒ) */
        .rank-í™©ì œ { 
            color: #fbbf24 !important; 
            font-size: 1.4rem !important; 
            text-shadow: 0 0 15px #fbbf24, 0 0 30px #d97706; 
            font-weight: 900 !important;
            animation: emperor-glow 1s infinite alternate;
        }
        @keyframes emperor-glow { from { transform: scale(1); } to { transform: scale(1.02); } }

        /* ğŸ’ VIP íš¨ê³¼ (100ë§Œ ì› ì´ìƒ) */
        .rank-VIP { 
            color: #fff; 
            text-shadow: 0 0 8px #818cf8, 0 0 15px #818cf8; 
            font-weight: bold; 
        }

        .news-msg { color: #facc15; font-weight: bold; background: #451a03; padding: 10px; border-radius: 8px; border: 1px solid #facc15; margin: 5px 0; }
        .bot-msg { color: #38bdf8; background: #1e293b; padding: 12px; border-left: 5px solid #38bdf8; margin: 5px 0; border-radius: 4px; }
        .nickname { font-weight: bold; color: #94a3b8; }
        a { color: #60a5fa; text-decoration: underline; }
    </style>
</head>
<body class="p-6">
    <div class="max-w-6xl mx-auto">
        <div id="chat-window" class="bg-gray-900 p-4 mb-4 shadow-inner"></div>
        
        <div class="bg-gray-800 p-5 rounded-xl shadow-2xl border border-gray-700">
            <textarea id="user-input" class="w-full p-4 bg-gray-950 rounded-lg mb-3 h-28 focus:ring-2 focus:ring-amber-500 outline-none border border-gray-700" placeholder="!ë„ë°• [ê¸ˆì•¡], !ì„ ë¬¼ [ë‹‰ë„¤ì„] [ê¸ˆì•¡] ì‚¬ìš© ê°€ëŠ¥"></textarea>
            <div class="flex justify-between items-center">
                <div class="flex gap-3">
                    <input type="file" id="file-btn" class="hidden" onchange="uploadFile()">
                    <button onclick="document.getElementById('file-btn').click()" class="bg-gray-700 hover:bg-gray-600 px-5 py-2 rounded-lg font-medium transition">ğŸ“ íŒŒì¼</button>
                    <span id="up-status" class="text-xs text-gray-500 self-center"></span>
                </div>
                <button onclick="send()" class="bg-amber-600 hover:bg-amber-500 px-12 py-3 rounded-lg font-black text-white transition-transform active:scale-95">ì „ì†¡</button>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        const nick = prompt("ì¬ë²Œì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”") || "ìµëª…";
        socket.emit('join', {nickname: nick});

        function linkify(text) {
            const urlPattern = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
            return text.replace(urlPattern, '<a href="$1" target="_blank">$1</a>');
        }

        socket.on('message', (data) => {
            const win = document.getElementById('chat-window');
            const div = document.createElement('div');
            div.className = 'msg-item';
            
            if (data.type === 'news') {
                div.innerHTML = `<div class="news-msg">ğŸ“¢ ${data.msg}</div>`;
            } else if (data.type === 'chat') {
                const rankClass = `rank-${data.rank}`;
                const prefix = data.rank === 'í™©ì œ' ? 'ğŸ‘‘ ' : (data.rank === 'VIP' ? 'ğŸ’ ' : '');
                div.innerHTML = `<span class="nickname">${data.nickname}</span>: <span class="${rankClass}">${prefix}${linkify(data.msg)}</span>`;
            } else if (data.type === 'bot') {
                div.innerHTML = `<div class="bot-msg">${linkify(data.msg)}</div>`;
            } else {
                div.innerHTML = `<span style="color: #64748b;">${data.msg}</span>`;
            }
            
            win.appendChild(div);
            win.scrollTop = win.scrollHeight;
        });

        function send() {
            const input = document.getElementById('user-input');
            if(input.value.trim()) {
                socket.emit('send_msg', {nickname: nick, msg: input.value});
                input.value = '';
            }
        }

        async function uploadFile() {
            const fileInput = document.getElementById('file-btn');
            if(!fileInput.files[0]) return;
            const status = document.getElementById('up-status');
            status.innerText = "â³...";
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('nickname', nick);
            const res = await fetch('/upload', { method: 'POST', body: formData });
            status.innerText = res.ok ? "âœ…" : "âŒ";
            fileInput.value = '';
        }

        document.getElementById('user-input').addEventListener('keydown', (e) => {
            if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); }
        });
    </script>
</body>
</html>
